<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="robots" content="noindex, nofollow">
  <title>DY Calc</title>
  <style>
    :root {
      --bg-color: rgb(0, 20, 27);
      --fg-color: rgb(227, 254, 247);
      --cat1-color: rgb(119, 170, 176);
      --cat2-color: rgb(176, 170, 119);
      --cat3-color: rgb(170, 119, 176);
    }

    html, body {
      margin: 0;
      padding: 0;
      touch-action: none;
      caret-color: currentcolor;
    }

    body {
      box-sizing: border-box;
      height: 100vh;
      width: 100vw;
      padding: 1em 0.6em;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Roboto', '-apple-system', 'BlinkMacSystemFont', sans-serif;
      font-feature-settings: 'tnum';
      font-size: 4vmin;
      background-color: var(--bg-color);
      color: var(--fg-color);
    }

    button {
      font-size: inherit;
      color: inherit;
      background: none;
      border: none;
      padding: 0;
      margin: 0;
    }

    #calculator {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      gap: 0.3em;
    }

    .result {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 0.5em;
    }

    #total {
      font-size: 2em;
    }

    .clear {
      padding: 0.8em;
      border: 0.15em solid var(--fg-color);
      color: var(--fg-color);
      border-radius: 25px;
      user-select: none;
    }

    .row {
      display: flex;
      gap: 0.3em;
      width: 100%;
    }

    .row > button {
      flex: 1 1 0;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 25px;
      box-sizing: border-box;
      user-select: none;
      border: 0.15em solid currentColor;
      height: 100%;
    }

    .row > button[data-count]:not([data-count='0']) {
      background-color: var(--cat-color);
      border-color: var(--cat-color);
      color: var(--fg-color);
    }

    .row > button::before {
      content: '\2007';
      font-weight: bold;
    }

    .row > button[data-count]:not([data-count='0'])::before {
      content: attr(data-count) '\00a0';
    }

    .row > button[data-price]::after {
      content: '\00a0' attr(data-price);
    }

    .category-1 { --cat-color: var(--cat1-color); }
    .category-2 { --cat-color: var(--cat2-color); }
    .category-3 { --cat-color: var(--cat3-color); }
  </style>
</head>
<body>
  <div id="calculator">
    <div class="result">
      <div id="total">0,00 €</div>
      <button class="clear" id="clear">AC</button>
    </div>

    <!-- Pfand-Reihe -->
    <div class="row" id="row-deposit"></div>

    <!-- Kategorie 3 -->
    <div class="row" id="row-cat3"></div>

    <!-- Kategorie 2 -->
    <div class="row" id="row-cat2"></div>

    <!-- Kategorie 1 -->
    <div class="row" id="row-cat1"></div>
  </div>

  <script>
    'use strict';

    // Service Worker (optional)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('serviceworker.js')
          .catch(() => { /* OK auch ohne SW */ });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const locale = document.documentElement.lang;
      const $total      = document.getElementById('total');
      const $clear      = document.getElementById('clear');
      let depositCount  = 0;

      // Button-Konfiguration
      const items = [
        { id: 'deposit_back', label: 'Pfand zurück', price: '1,00', type: 'pfand' },
        { id: 'beer',        label: 'Bier/Radler',   price: '3,00', type: 'option', cat: 3 },
        { id: 'wine',        label: 'Weinschorle',   price: '3,00', type: 'option', cat: 3 },
        { id: 'longdrink',   label: 'Longdrink',     price: '5,00', type: 'option', cat: 2 },
        { id: 'vodka',       label: 'Vodka Mate',    price: '6,50', type: 'option', cat: 2 },
        { id: 'shot',        label: 'Shot',          price: '1,50', type: 'option', cat: 2, noDeposit: true },
        { id: 'water',       label: 'Wasser/Cola',   price: '2,00', type: 'option', cat: 1 },
        { id: 'soft',        label: 'Softgetränk',   price: '2,50', type: 'option', cat: 1 }
      ];

      // Referenzen auf Zeilen-Container
      const $rowDeposit = document.getElementById('row-deposit');
      const $rowCat3    = document.getElementById('row-cat3');
      const $rowCat2    = document.getElementById('row-cat2');
      const $rowCat1    = document.getElementById('row-cat1');

      // Buttons erzeugen und in die jeweiligen Zeilen einfügen
      items.forEach(item => {
        const btn = document.createElement('button');
        btn.id = item.id;
        btn.setAttribute('data-price', item.price);
        btn.textContent = item.label;
        if (item.type === 'option') {
          btn.classList.add(`category-${item.cat}`);
          // Einfügen in die Zeile der jeweiligen Kategorie
          if (item.cat === 3) $rowCat3.appendChild(btn);
          if (item.cat === 2) $rowCat2.appendChild(btn);
          if (item.cat === 1) $rowCat1.appendChild(btn);
        } else {
          // Pfand-Button
          $rowDeposit.appendChild(btn);
        }
        if (item.noDeposit) {
          btn.setAttribute('no-deposit', '');
        }
      });

      const $depositBtn = document.getElementById('deposit_back');
      const $options    = [
        ...$rowCat3.querySelectorAll('button'),
        ...$rowCat2.querySelectorAll('button'),
        ...$rowCat1.querySelectorAll('button')
      ];

      // AC-Button zurücksetzen
      $clear.addEventListener('click', () => {
        // Bei allen Buttons data-count entfernen
        [$depositBtn, ...$options].forEach(b => b.removeAttribute('data-count'));
        depositCount = 0;
        calculate();
      });

      // Klick zum Zähler hochsetzen (kein Long-Touch mehr)
      function updateCount(elem) {
        const current = parseInt(elem.getAttribute('data-count')) || 0;
        const next    = (current + 1 < 50) ? current + 1 : 0;
        elem.setAttribute('data-count', next);
        return current !== next;
      }

      // Option-Buttons
      $options.forEach(btn => {
        btn.addEventListener('click', () => {
          if (updateCount(btn)) {
            // Deposit nur erhöhen, wenn kein "no-deposit"
            if (!btn.hasAttribute('no-deposit')) {
              depositCount++;
            }
            calculate();
          }
        });
      });

      // Pfand-Button
      $depositBtn.addEventListener('click', () => {
        if (updateCount($depositBtn)) {
          calculate();
        }
      });

      // Hilfsfunktion: Komma oder Punkt parsen
      function parseAnyFloat(val) {
        const s = val.replace(',', '.');
        return !isNaN(s) ? parseFloat(s) : 0;
      }

      // Zentrale Berechnung
      function calculate() {
        let total = 0;

        // Summe aller Options-Buttons
        $options.forEach(btn => {
          const cnt   = parseInt(btn.getAttribute('data-count')) || 0;
          const price = parseAnyFloat(btn.getAttribute('data-price'));
          total += cnt * price;
        });

        // Pfand verrechnen: hinzugezählt und abgezählt
        const depositBackCnt = parseInt($depositBtn.getAttribute('data-count')) || 0;
        const depositPrice   = parseAnyFloat($depositBtn.getAttribute('data-price'));
        total += depositCount * depositPrice;
        total -= depositBackCnt * depositPrice;

        $total.textContent = total.toLocaleString(locale, {
          style: 'currency',
          currency: 'EUR'
        });
      }

      // Initialer Aufruf
      calculate();
    });
  </script>
</body>
</html>

