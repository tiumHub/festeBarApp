<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="robots" content="noindex, nofollow">
  <title>DY Calc</title>
  <style>
    :root {
      --bg-color: rgb(0, 20, 27);
      --fg-color: rgb(227, 254, 247);
      --cat1-color: rgb(119, 170, 176);
      --cat2-color: rgb(176, 170, 119);
      --cat3-color: rgb(170, 119, 176);
    }

    html, body {
      margin: 0;
      padding: 0;
      touch-action: none;
      caret-color: currentcolor;
    }

    body {
      box-sizing: border-box;
      height: 100vh;
      width: 100vw;
      padding: 1em 0.6em;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Roboto', '-apple-system', 'BlinkMacSystemFont', sans-serif;
      font-feature-settings: 'tnum';
      font-size: 4vmin;
      background-color: var(--bg-color);
      color: var(--fg-color);
    }

    button {
      font-size: inherit;
      color: inherit;
      background: none;
      border: none;
      padding: 0;
      margin: 0;
    }

    #calculator {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: 0.5fr repeat(6, 1fr);
      gap: 0.3em;
      width: 100%;
      height: 100%;
    }

    .result {
      grid-column: span 2;
      display: grid;
      grid-template-columns: 1fr auto;
      justify-content: right;
      align-items: center;
    }

    #total {
      font-size: 2em;
      padding-right: 0.5em;
    }

    .btn, .clear {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      border-radius: 25px;
      box-sizing: border-box;
      user-select: none;
      border: 0.15em solid currentColor;
    }

    .btn {
      color: var(--cat-color, currentColor);
    }

    .btn[data-count]:not([data-count='0']) {
      background-color: var(--cat-color);
      border-color: var(--cat-color);
      color: var(--fg-color);
    }

    .btn::before {
      content: '\2007';
      font-weight: bold;
    }

    .btn[data-count]:not([data-count='0'])::before {
      content: attr(data-count) '\00a0';
    }

    .btn[data-price]::after {
      content: '\00a0' attr(data-price);
    }

    .clear {
      padding: 0.8em;
      border-color: var(--fg-color);
      color: var(--fg-color);
    }

    .category-1 { --cat-color: var(--cat1-color); }
    .category-2 { --cat-color: var(--cat2-color); }
    .category-3 { --cat-color: var(--cat3-color); }
  </style>
</head>
<body>
  <div id="calculator">
    <div class="result">
      <div id="total">0,00 €</div>
      <button class="clear" id="clear">AC</button>
    </div>
    <!-- Buttons werden per JS erstellt -->
  </div>

  <script>
    'use strict';

    // Service Worker (optional, falls serviceworker.js vorhanden)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('serviceworker.js')
          .catch(() => { /* still OK without SW */ });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const locale = document.documentElement.lang;
      const $calc = document.getElementById('calculator');
      const $total = document.getElementById('total');
      const $clear = document.getElementById('clear');
      let deposit = 0;

      // Konfiguration der Buttons
      const items = [
        { id: 'deposit_back', label: 'Pfand zurück', price: '1,00', type: 'pfand' },
        { id: 'beer',        label: 'Bier/Radler',   price: '3,00', type: 'option', cat: 3 },
        { id: 'wine',        label: 'Weinschorle',   price: '3,00', type: 'option', cat: 3 },
        { id: 'longdrink',   label: 'Longdrink',     price: '5,00', type: 'option', cat: 2 },
        { id: 'vodka',       label: 'Vodka Mate',    price: '6,50', type: 'option', cat: 2 },
        { id: 'shot',        label: 'Shot',          price: '1,50', type: 'option', cat: 2, noDeposit: true },
        { id: 'water',       label: 'Wasser/Cola',   price: '2,00', type: 'option', cat: 1 },
        { id: 'soft',        label: 'Softgetränk',   price: '2,50', type: 'option', cat: 1 }
      ];

      // Buttons dynamisch erstellen
      items.forEach(item => {
        const btn = document.createElement('button');
        btn.id = item.id;
        btn.classList.add('btn');
        if (item.type === 'option') {
          btn.classList.add(`category-${item.cat}`);
        }
        btn.setAttribute('data-price', item.price);
        if (item.noDeposit) btn.setAttribute('no-deposit', '');
        btn.textContent = item.label;
        $calc.appendChild(btn);
      });

      const $buttons = Array.from($calc.querySelectorAll('.btn'));
      const $depositBtn = document.getElementById('deposit_back');
      const $options = $buttons.filter(b => b !== $depositBtn);

      // Reset-Funktion
      $clear.addEventListener('click', () => {
        [$depositBtn, ...$options].forEach(btn => btn.removeAttribute('data-count'));
        deposit = 0;
        calculate();
      });

      // Klick-Handling (nur Zähler hoch, kein “long touch”)
      function updateCount(elem) {
        const current = parseInt(elem.getAttribute('data-count')) || 0;
        const next = (current + 1 < 50) ? current + 1 : 0;
        elem.setAttribute('data-count', next);
        return current !== next;
      }

      // Aktion für jede Option
      $options.forEach(btn => {
        btn.addEventListener('click', () => {
          if (updateCount(btn)) {
            if (btn.hasAttribute('no-deposit')) {
              deposit++;
            }
            calculate();
          }
        });
      });

      // Aktion Pfand
      $depositBtn.addEventListener('click', () => {
        if (updateCount($depositBtn)) {
          calculate();
        }
      });

      // Hilfs-Funktion: Komma oder Punkt parsen
      function parseAnyFloat(val) {
        const s = val.replace(',', '.');
        return !isNaN(s) ? parseFloat(s) : 0;
      }

      // Zentrale Berechnung
      function calculate() {
        let total = 0;

        // Summe aller Optionen
        $options.forEach(btn => {
          const cnt = parseInt(btn.getAttribute('data-count')) || 0;
          const price = parseAnyFloat(btn.getAttribute('data-price'));
          total += cnt * price;
        });

        // Pfand verrechnen
        const depositBackCount = parseInt($depositBtn.getAttribute('data-count')) || 0;
        const depositPrice = parseAnyFloat($depositBtn.getAttribute('data-price'));
        total += deposit * depositPrice;
        total -= depositBackCount * depositPrice;

        $total.textContent = total.toLocaleString(locale, {
          style: 'currency',
          currency: 'EUR'
        });
      }

      // Initialer Aufruf
      calculate();
    });
  </script>
</body>
</html>
